{% extends 'base.html' %} {% block title %}Dashboard User - LapangIN{% endblock
%} {% block content %}
<div class="min-h-screen bg-neutral-50" id="userDashboard">
  <!-- Header -->
  <div class="bg-white border-b border-neutral-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="py-6">
        <div class="flex items-center justify-between">
          <div>
            <h1 class="text-2xl font-display font-bold text-neutral-900">
              Dashboard User
            </h1>
            <p class="text-neutral-600" id="welcomeMessage">
              Selamat datang kembali!
            </p>
          </div>
          <div class="flex items-center space-x-4">
            <div class="flex items-center text-sm text-neutral-600">
              <div class="w-2 h-2 bg-blue-500 rounded-full mr-2"></div>
              User/Penyewa
            </div>
            <button
              onclick="logoutUser()"
              class="btn btn-secondary"
              id="logoutBtn"
            >
              Logout
              <svg
                class="w-4 h-4 ml-2"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M17 16l4-4m0 0l-4-4m4 4H3"
                ></path>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div id="dashboardLoading" class="flex justify-center items-center py-20">
    <div
      class="w-8 h-8 border-4 border-primary-500 border-t-transparent rounded-full animate-spin"
    ></div>
  </div>

  <!-- Main Content -->
  <div
    class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 hidden"
    id="dashboardContent"
  >
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- User Info Card -->
      <div class="lg:col-span-1">
        <div
          class="bg-white rounded-2xl shadow-soft border border-neutral-200 p-6"
        >
          <div class="text-center">
            <div
              class="w-20 h-20 gradient-primary rounded-2xl flex items-center justify-center mx-auto mb-4"
            >
              <svg
                class="w-10 h-10 text-white"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
                ></path>
              </svg>
            </div>
            <h3 class="text-lg font-semibold text-neutral-900 mb-1">
              {{ user.first_name }} {{ user.last_name }}
            </h3>
            <p class="text-neutral-600 text-sm mb-4">@{{ user.username }}</p>

            <div class="space-y-3 text-left">
              <div class="flex justify-between text-sm">
                <span class="text-neutral-600">Email:</span>
                <span class="text-neutral-900">{{ user.email }}</span>
              </div>
              {% if user.phone_number %}
              <div class="flex justify-between text-sm">
                <span class="text-neutral-600">Telepon:</span>
                <span class="text-neutral-900">{{ user.phone_number }}</span>
              </div>
              {% endif %}
              <div class="flex justify-between text-sm">
                <span class="text-neutral-600">Bergabung:</span>
                <span class="text-neutral-900"
                  >{{ user.created_at|date:"d M Y" }}</span
                >
              </div>
            </div>

            <button class="btn btn-primary mt-6 w-full">Edit Profil</button>
          </div>
        </div>
      </div>

      <!-- Main Content Area -->
      <div class="lg:col-span-2 space-y-6">
        <!-- Quick Actions -->
        <div
          class="bg-white rounded-2xl shadow-soft border border-neutral-200 p-6"
        >
          <h2 class="text-lg font-semibold text-neutral-900 mb-4">
            Aksi Cepat
          </h2>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <a
              href="/lapangan"
              class="btn btn-primary card-hover p-4 text-left"
            >
              <div class="flex items-center">
                <div
                  class="w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center mr-3"
                >
                  <svg
                    class="w-5 h-5 text-white"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                    ></path>
                  </svg>
                </div>
                <div>
                  <div class="font-medium text-white">Cari Lapangan</div>
                  <div class="text-white/80 text-sm">
                    Temukan lapangan favorit
                  </div>
                </div>
              </div>
            </a>

            <a
              href="/booking-history"
              class="btn btn-secondary card-hover p-4 text-left"
            >
              <div class="flex items-center">
                <div
                  class="w-10 h-10 bg-neutral-100 rounded-xl flex items-center justify-center mr-3"
                >
                  <svg
                    class="w-5 h-5 text-neutral-600"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
                    ></path>
                  </svg>
                </div>
                <div>
                  <div class="font-medium text-neutral-900">
                    Riwayat Booking
                  </div>
                  <div class="text-neutral-600 text-sm">
                    Lihat semua booking Anda
                  </div>
                </div>
              </div>
            </a>
          </div>
        </div>

        <!-- Recent Bookings -->
        <div
          class="bg-white rounded-2xl shadow-soft border border-neutral-200 p-6"
        >
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-lg font-semibold text-neutral-900">
              Booking Terbaru
            </h2>
            <a
              href="/booking-history"
              class="text-primary-600 hover:text-primary-700 text-sm font-medium"
            >
              Lihat Semua
            </a>
          </div>

          <!-- Loading State -->
          <div id="bookingsLoading" class="text-center py-8">
            <div class="inline-block">
              <svg
                class="animate-spin h-8 w-8 text-primary-500"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
              >
                <circle
                  class="opacity-25"
                  cx="12"
                  cy="12"
                  r="10"
                  stroke="currentColor"
                  stroke-width="4"
                ></circle>
                <path
                  class="opacity-75"
                  fill="currentColor"
                  d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                ></path>
              </svg>
            </div>
            <p class="mt-2 text-neutral-600">Memuat booking...</p>
          </div>

          <!-- Booking Items Container -->
          <div id="bookingsList" class="space-y-4">
            <!-- Will be populated dynamically -->
          </div>

          <!-- Empty State -->
          <div id="bookingsEmpty" class="text-center py-8 hidden">
            <div
              class="w-16 h-16 bg-neutral-100 rounded-2xl flex items-center justify-center mx-auto mb-4"
            >
              <svg
                class="w-8 h-8 text-neutral-400"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
                ></path>
              </svg>
            </div>
            <h3 class="text-neutral-900 font-medium mb-2">Belum ada booking</h3>
            <p class="text-neutral-600 text-sm mb-4">
              Anda belum memiliki booking lapangan. Mulai cari lapangan
              sekarang!
            </p>
            <a href="/lapangan" class="btn btn-primary">
              Cari Lapangan Sekarang
            </a>
          </div>
        </div>

        <!-- Favorite Venues -->
        <div
          class="bg-white rounded-2xl shadow-soft border border-neutral-200 p-6"
        >
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-lg font-semibold text-neutral-900">
              Lapangan Favorit
            </h2>
            <a
              href="/favorites"
              class="text-primary-600 hover:text-primary-700 text-sm font-medium"
            >
              Lihat Semua
            </a>
          </div>

          <!-- Empty State -->
          <div class="text-center py-8">
            <div
              class="w-16 h-16 bg-neutral-100 rounded-2xl flex items-center justify-center mx-auto mb-4"
            >
              <svg
                class="w-8 h-8 text-neutral-400"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"
                ></path>
              </svg>
            </div>
            <h3 class="text-neutral-900 font-medium mb-2">Belum ada favorit</h3>
            <p class="text-neutral-600 text-sm mb-4">
              Tandai lapangan favorit Anda untuk akses yang lebih mudah
            </p>
            <a href="/lapangan" class="btn btn-primary"> Jelajahi Lapangan </a>
          </div>
        </div>
      </div>
      {% endblock %} {% block script %}
      <script>
        // Load dashboard content on page load
        document.addEventListener("DOMContentLoaded", async function () {
          try {
            // Check user authentication
            const userStatus = await checkUserStatus();

            // Load dashboard data
            const dashboardData = await makeAjaxRequest(
              "/api/user-dashboard/",
              {
                headers: {
                  Accept: "application/json",
                },
              }
            );

            if (dashboardData.success) {
              // Update welcome message
              const welcomeMessage = document.getElementById("welcomeMessage");
              welcomeMessage.textContent = `Selamat datang kembali, ${dashboardData.data.user.first_name}!`;

              // Render dashboard content
              renderDashboardContent(dashboardData.data);

              // Hide loading and show content
              document
                .getElementById("dashboardLoading")
                .classList.add("hidden");
              document
                .getElementById("dashboardContent")
                .classList.remove("hidden");

              // Load recent bookings
              loadRecentBookings();
            }
          } catch (error) {
            console.error("Error loading dashboard:", error);
            showNotification(
              "Gagal memuat dashboard. Silakan refresh halaman.",
              "error"
            );

            // Hide loading
            document.getElementById("dashboardLoading").classList.add("hidden");
          }
        });

        function renderDashboardContent(data) {
          const content = document.getElementById("dashboardContent");
          const user = data.user;
          const joinDate = new Date(
            user.created_at || Date.now()
          ).toLocaleDateString("id-ID", {
            day: "numeric",
            month: "short",
            year: "numeric",
          });

          content.innerHTML = `
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- User Info Card -->
        <div class="lg:col-span-1">
          <div class="bg-white rounded-2xl shadow-soft border border-neutral-200 p-6">
            <div class="text-center">
              <div class="w-20 h-20 gradient-primary rounded-2xl flex items-center justify-center mx-auto mb-4">
                <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
              </div>
              <h3 class="text-lg font-semibold text-neutral-900 mb-1">
                ${user.first_name} ${user.last_name}
              </h3>
              <p class="text-neutral-600 text-sm mb-4">@${user.username}</p>

              <div class="space-y-3 text-left">
                <div class="flex justify-between text-sm">
                  <span class="text-neutral-600">Email:</span>
                  <span class="text-neutral-900">${user.email}</span>
                </div>
                ${
                  user.phone_number
                    ? `
                <div class="flex justify-between text-sm">
                  <span class="text-neutral-600">Telepon:</span>
                  <span class="text-neutral-900">${user.phone_number}</span>
                </div>
                `
                    : ""
                }
                <div class="flex justify-between text-sm">
                  <span class="text-neutral-600">Bergabung:</span>
                  <span class="text-neutral-900">${joinDate}</span>
                </div>
              </div>

              <button class="btn btn-primary mt-6 w-full" onclick="editProfile()">Edit Profil</button>
            </div>
          </div>

          <!-- Quick Actions -->
          <div class="bg-white rounded-2xl shadow-soft border border-neutral-200 p-6 mt-6">
            <h2 class="text-lg font-semibold text-neutral-900 mb-4">Aksi Cepat</h2>
            <div class="space-y-3">
              <button class="w-full text-left px-4 py-3 rounded-xl bg-neutral-50 hover:bg-neutral-100 transition-colors" onclick="searchVenues()">
                <div class="flex items-center">
                  <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                    <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                  </div>
                  <div>
                    <h3 class="font-medium text-neutral-900">Cari Lapangan</h3>
                    <p class="text-sm text-neutral-600">Temukan lapangan terdekat</p>
                  </div>
                </div>
              </button>
              
              <button class="w-full text-left px-4 py-3 rounded-xl bg-neutral-50 hover:bg-neutral-100 transition-colors" onclick="viewBookings()">
                <div class="flex items-center">
                  <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-3">
                    <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                    </svg>
                  </div>
                  <div>
                    <h3 class="font-medium text-neutral-900">Riwayat Booking</h3>
                    <p class="text-sm text-neutral-600">Lihat booking Anda</p>
                  </div>
                </div>
              </button>
            </div>
          </div>
        </div>

        <!-- Recent Bookings & Activities -->
        <div class="lg:col-span-2 space-y-6">
          <!-- Recent Bookings -->
          <div class="bg-white rounded-2xl shadow-soft border border-neutral-200 p-6">
            <div class="flex items-center justify-between mb-4">
              <h2 class="text-lg font-semibold text-neutral-900">Booking Terbaru</h2>
              <button onclick="viewBookings()" class="text-primary-600 hover:text-primary-700 text-sm font-medium">
                Lihat Semua
              </button>
            </div>

            <!-- Loading State -->
            <div id="bookingsLoading" class="text-center py-8">
              <div class="inline-block">
                <svg class="animate-spin h-8 w-8 text-primary-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
              </div>
              <p class="mt-2 text-neutral-600">Memuat booking...</p>
            </div>

            <!-- Booking Items Container -->
            <div id="bookingsList" class="space-y-4"></div>

            <!-- Empty State -->
            <div id="bookingsEmpty" class="text-center py-8 hidden">
              <div class="w-16 h-16 bg-neutral-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                <svg class="w-8 h-8 text-neutral-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                </svg>
              </div>
              <h3 class="text-neutral-900 font-medium mb-2">Belum ada booking</h3>
              <p class="text-neutral-600 text-sm mb-4">
                Anda belum memiliki booking lapangan. Mulai cari lapangan sekarang!
              </p>
              <button onclick="searchVenues()" class="btn btn-primary">
                Cari Lapangan Sekarang
              </button>
            </div>
          </div>

          <!-- Favorite Venues -->
          <div class="bg-white rounded-2xl shadow-soft border border-neutral-200 p-6">
            <div class="flex items-center justify-between mb-4">
              <h2 class="text-lg font-semibold text-neutral-900">Lapangan Favorit</h2>
              <button onclick="viewFavorites()" class="text-primary-600 hover:text-primary-700 text-sm font-medium">
                Lihat Semua
              </button>
            </div>

            <!-- Empty State -->
            <div class="text-center py-8">
              <div class="w-16 h-16 bg-neutral-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                <svg class="w-8 h-8 text-neutral-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                </svg>
              </div>
              <h3 class="text-neutral-900 font-medium mb-2">Belum ada favorit</h3>
              <p class="text-neutral-600 text-sm mb-4">
                Tandai lapangan favorit Anda untuk akses yang lebih mudah
              </p>
              <button onclick="searchVenues()" class="btn btn-primary">Jelajahi Lapangan</button>
            </div>
          </div>
        </div>
      </div>
    `;
        }

        // Navigation functions
        function editProfile() {
          window.location.href = "/profile/";
        }

        function searchVenues() {
          window.location.href = "/lapangan";
        }

        function viewBookings() {
          window.location.href = "/booking-history";
        }

        function viewFavorites() {
          window.location.href = "/favorites";
        }

        // Load Recent Bookings
        async function loadRecentBookings() {
          try {
            const bookingsLoading = document.getElementById("bookingsLoading");
            const bookingsList = document.getElementById("bookingsList");
            const bookingsEmpty = document.getElementById("bookingsEmpty");

            // Make sure elements exist before trying to manipulate them
            if (!bookingsLoading || !bookingsList || !bookingsEmpty) {
              console.error("Booking elements not found in DOM");
              return;
            }

            const response = await fetch("/bookings/history/?limit=3");
            const data = await response.json();

            if (data.success && data.data.bookings.length > 0) {
              bookingsLoading.classList.add("hidden");
              bookingsEmpty.classList.add("hidden");
              bookingsList.classList.remove("hidden");

              // Display only 3 most recent bookings
              const recentBookings = data.data.bookings.slice(0, 3);
              bookingsList.innerHTML = recentBookings
                .map((booking) => createBookingItem(booking))
                .join("");
            } else {
              bookingsLoading.classList.add("hidden");
              bookingsList.classList.add("hidden");
              bookingsEmpty.classList.remove("hidden");
            }
          } catch (error) {
            console.error("Error loading bookings:", error);
            const bookingsLoading = document.getElementById("bookingsLoading");
            const bookingsEmpty = document.getElementById("bookingsEmpty");
            if (bookingsLoading) bookingsLoading.classList.add("hidden");
            if (bookingsEmpty) bookingsEmpty.classList.remove("hidden");
          }
        }

        function createBookingItem(booking) {
          const statusColors = {
            pending: "bg-yellow-100 text-yellow-800",
            confirmed: "bg-blue-100 text-blue-800",
            completed: "bg-green-100 text-green-800",
            cancelled: "bg-red-100 text-red-800",
          };

          const statusLabels = {
            pending: "Menunggu",
            confirmed: "Dikonfirmasi",
            completed: "Selesai",
            cancelled: "Dibatalkan",
          };

          const statusColor =
            statusColors[booking.booking_status] || "bg-gray-100 text-gray-800";
          const statusLabel =
            statusLabels[booking.booking_status] || booking.booking_status;

          const bookingDate = new Date(booking.booking_date).toLocaleDateString(
            "id-ID",
            {
              month: "short",
              day: "numeric",
            }
          );

          return `
            <div class="flex items-center justify-between p-4 bg-neutral-50 rounded-xl hover:bg-neutral-100 transition-colors">
              <div class="flex-1">
                <div class="flex items-center gap-3 mb-2">
                  <h4 class="font-semibold text-neutral-900">${
                    booking.venue_name
                  }</h4>
                  <span class="px-2 py-1 rounded-full text-xs font-semibold ${statusColor}">
                    ${statusLabel}
                  </span>
                </div>
                <p class="text-sm text-neutral-600">
                  ${booking.court_name} â€¢ ${bookingDate} ${booking.start_time}
                </p>
              </div>
              <div class="text-right">
                <p class="font-semibold text-neutral-900">
                  Rp ${parseInt(booking.total_price).toLocaleString("id-ID")}
                </p>
                <a
                  href="/booking-history"
                  class="text-primary-600 hover:text-primary-700 text-xs font-medium"
                >
                  Lihat Detail
                </a>
              </div>
            </div>
          `;
        }
      </script>
      {% endblock %}
    </div>
  </div>
</div>
