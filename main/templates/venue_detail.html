{% extends 'base.html' %}
{% load static %}

{% block meta %}
<title>{{ title|default:"Detail Venue" }} - LapangIn</title>
{% endblock meta %}

{% block content %}
<div class="container mx-auto px-4 py-8">
  <!-- Venue Name and Category -->
  <div class="mb-6">
    <h1 id="venue-name" class="text-3xl font-bold"></h1>
    <div class="flex items-center gap-4 mt-2">
      <span id="venue-category" class="text-neutral-500"></span>
      <div class="flex items-center gap-1">
        <span id="venue-rating" class="font-medium"></span>
        <div class="flex text-yellow-400" id="overall-stars"></div>
        <span class="text-neutral-500">(<span id="rating-count"></span> ulasan)</span>
      </div>
    </div>
  </div>

  <!-- Image Gallery -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
    <div class="lg:col-span-2">
      <div class="aspect-w-16 aspect-h-9 rounded-2xl overflow-hidden bg-neutral-100">
        <img id="main-venue-image" class="w-full h-full object-cover">
      </div>
      <div id="venue-image-thumbs" class="grid grid-cols-4 gap-4 mt-4"></div>
    </div>

    <!-- Booking Section -->
    <div class="bg-white rounded-2xl shadow-soft p-6">
      <h3 class="text-lg font-bold mb-4">Pesan Lapangan</h3>
      
      <!-- Price -->
      <div class="flex justify-between items-center mb-4">
        <span class="text-neutral-600">Harga per jam</span>
        <div class="font-medium">Rp <span id="venue-price"></span></div>
      </div>

      <!-- Calendar -->
      <div class="mb-6">
        <div class="grid grid-cols-7 gap-1 text-center text-sm text-neutral-500 mb-2">
          <div>Min</div>
          <div>Sen</div>
          <div>Sel</div>
          <div>Rab</div>
          <div>Kam</div>
          <div>Jum</div>
          <div>Sab</div>
        </div>
        <div id="calendar-grid" class="grid grid-cols-7 gap-1"></div>
      </div>

      <!-- Time Slots -->
      <div id="time-slots-section">
        <h4 class="font-medium mb-3">Pilih Jam</h4>
        <div id="time-slots" class="grid grid-cols-3 gap-2"></div>
      </div>

      <!-- Courts -->
      <div id="courts-section" class="mt-6">
        <h4 class="font-medium mb-3">Pilih Lapangan</h4>
        <div id="courts-list" class="space-y-2"></div>
      </div>

      <button id="book-button" class="w-full bg-gradient-to-r from-[#3f07a3] to-[#4E71FF] text-white rounded-lg py-3 font-medium mt-6 hidden">
        Pesan Sekarang
      </button>
    </div>
  </div>

  <!-- Venue Details -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
    <div class="lg:col-span-2 space-y-6">
      <!-- Description -->
      <div class="bg-white rounded-2xl shadow-soft p-6">
        <h3 class="text-lg font-bold mb-4">Tentang Venue</h3>
        <p id="venue-description" class="text-neutral-600"></p>
      </div>

      <!-- Facilities -->
      <div class="bg-white rounded-2xl shadow-soft p-6">
        <h3 class="text-lg font-bold mb-4">Fasilitas</h3>
        <div id="venue-facilities" class="grid grid-cols-2 gap-4"></div>
      </div>

      <!-- Reviews -->
      <div class="bg-white rounded-2xl shadow-soft p-6">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-lg font-bold">Ulasan</h3>
          {% if request.user.is_authenticated %}
          <button id="write-review" class="text-sm font-medium text-[#3f07a3] hover:text-[#4E71FF]">
            Tulis Ulasan
          </button>
          {% endif %}
        </div>

        <!-- Review Summary -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
          <!-- Overall Rating -->
          <div class="flex items-center gap-4">
            <div class="text-4xl font-bold" id="avg-rating"></div>
            <div>
              <div class="flex text-yellow-400 mb-1" id="rating-stars"></div>
              <div class="text-sm text-neutral-500">
                <span id="total-reviews"></span> ulasan
              </div>
            </div>
          </div>

          <!-- Rating Categories -->
          <div class="space-y-3">
            <div>
              <div class="flex justify-between text-sm mb-1">
                <span>Kebersihan</span>
                <span id="cleanliness-score"></span>
              </div>
              <div class="h-2 bg-neutral-100 rounded-full overflow-hidden">
                <div id="cleanliness-rating" class="h-full bg-yellow-400 rounded-full"></div>
              </div>
            </div>
            <div>
              <div class="flex justify-between text-sm mb-1">
                <span>Kondisi Lapangan</span>
                <span id="court-condition-score"></span>
              </div>
              <div class="h-2 bg-neutral-100 rounded-full overflow-hidden">
                <div id="court-condition-rating" class="h-full bg-yellow-400 rounded-full"></div>
              </div>
            </div>
            <div>
              <div class="flex justify-between text-sm mb-1">
                <span>Komunikasi</span>
                <span id="communication-score"></span>
              </div>
              <div class="h-2 bg-neutral-100 rounded-full overflow-hidden">
                <div id="communication-rating" class="h-full bg-yellow-400 rounded-full"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Review List -->
        <div id="review-list" class="space-y-4"></div>
      </div>
    </div>

    <!-- Venue Info -->
    <div class="space-y-6">
      <div class="bg-white rounded-2xl shadow-soft p-6">
        <h3 class="text-lg font-bold mb-4">Informasi Venue</h3>
        <div class="space-y-4">
          <div>
            <div class="text-sm text-neutral-500 mb-1">Alamat</div>
            <div id="venue-address"></div>
          </div>
          <div>
            <div class="text-sm text-neutral-500 mb-1">Kontak</div>
            <div id="venue-contact"></div>
          </div>
          <div>
            <div class="text-sm text-neutral-500 mb-1">Jumlah Lapangan</div>
            <div><span id="venue-courts"></span> lapangan</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Review Modal -->
{% if request.user.is_authenticated %}
<div id="review-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center hidden">
  <div class="bg-white rounded-2xl p-6 max-w-lg w-full mx-4">
    <h3 class="text-lg font-bold mb-6">Tulis Ulasan</h3>
    <form id="review-form">
      <div class="mb-6">
        <label class="block mb-2">Rating</label>
        <div id="rating-input" class="flex gap-1">
          {% for i in "12345" %}
          <button type="button" class="text-neutral-200">
            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
              <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.974a1 1 0 00.95.69h4.178c.969 0 1.371 1.24.588 1.81l-3.38 2.455a1 1 0 00-.364 1.118l1.287 3.974c.3.921-.755 1.688-1.54 1.118l-3.38-2.455a1 1 0 00-1.175 0l-3.38 2.455c-.784.57-1.839-.197-1.54-1.118l1.286-3.974a1 1 0 00-.364-1.118L2.046 9.4c-.783-.57-.38-1.81.588-1.81h4.178a1 1 0 00.95-.69l1.287-3.974z"/>
            </svg>
          </button>
          {% endfor %}
        </div>
      </div>
      <div class="mb-6">
        <label class="block mb-2">Komentar</label>
        <textarea class="w-full rounded-lg border border-neutral-200 p-3 h-32" required></textarea>
      </div>
      <div class="flex justify-end gap-3">
        <button type="button" id="cancel-review" class="px-4 py-2 rounded-lg text-neutral-600 hover:bg-neutral-100">
          Batal
        </button>
        <button type="submit" class="px-4 py-2 rounded-lg bg-gradient-to-r from-[#3f07a3] to-[#4E71FF] text-white">
          Kirim Ulasan
        </button>
      </div>
    </form>
  </div>
</div>
{% endif %}
{% endblock content %}

{% block scripts %}
<script>
  // Pass authentication status and venue id to frontend
  window.isAuthenticated = {{ is_authenticated|yesno:"true,false" }};
  window.venueId = "{{ venue_id }}";
</script>
<script src="{% static 'js/venue_detail.js' %}"></script>
{% endblock %}
